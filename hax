if not game:IsLoaded() then
    game.Loaded:Wait()
end

local Players      = game:GetService("Players") 
local RunService   = game:GetService("RunService")
local UIS          = game:GetService("UserInputService")
local Http         = game:GetService("HttpService")
local TS           = game:GetService("TweenService")
local Teleport     = game:GetService("TeleportService")

local plr          = Players.LocalPlayer
local cam          = workspace.CurrentCamera

local flying       = false
local flySpeed     = 5
local autoCollect  = false
local godConns     = {}
local controls     = {W=0, S=0, A=0, D=0, Space=0, Ctrl=0}

local notifyBusy = false
local scriptFullyLoaded = false

-- Vari√°veis para o Sistema Garama
local TERMOS = {"garama", "madundung"}
local DISTANCIA_MAX_FORCADA = 450
local promptsModificados = {}
local currentHighlight = nil

-- =============================================
-- Notify Function
-- =============================================
local function notify(msg, color)
    color = color or Color3.fromRGB(0, 170, 255)
    if notifyBusy then task.wait(0.4) end
    notifyBusy = true
    
    task.spawn(function()
        local gui = Instance.new("ScreenGui")
        gui.Name = "HaxNotify"
        gui.Parent = plr:WaitForChild("PlayerGui")
        
        local main = Instance.new("Frame", gui)
        main.Size = UDim2.new(0, 0, 0, 35)
        main.Position = UDim2.new(0.5, 0, 0.08, 0)
        main.AnchorPoint = Vector2.new(0.5, 0.5)
        main.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
        main.BackgroundTransparency = 0.25
        main.BorderSizePixel = 0
        main.ClipsDescendants = true
        
        Instance.new("UICorner", main).CornerRadius = UDim.new(0, 6)
        
        local accent = Instance.new("Frame", main)
        accent.Size = UDim2.new(0, 4, 1, 0)
        accent.BackgroundColor3 = color
        
        local txt = Instance.new("TextLabel", main)
        txt.Size = UDim2.new(1, -30, 1, 0)
        txt.Position = UDim2.new(0, 15, 0, 0)
        txt.BackgroundTransparency = 1
        txt.Font = Enum.Font.GothamMedium
        txt.Text = msg
        txt.TextColor3 = Color3.new(1,1,1)
        txt.TextSize = 15
        txt.TextXAlignment = Enum.TextXAlignment.Left
        txt.RichText = true
        
        TS:Create(main, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 280, 0, 40)}):Play()
        task.wait(3.2)
        local tw = TS:Create(main, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 0, 0, 40), BackgroundTransparency = 1})
        tw:Play()
        tw.Completed:Connect(function() gui:Destroy() notifyBusy = false end)
    end)
end

-- =============================================
-- Fun√ß√µes de Utilidade
-- =============================================
local function waitForCharacter(timeout)
    timeout = timeout or 1
    local start = tick()
    while not plr.Character and tick() - start < timeout do task.wait() end
    return plr.Character
end

-- =============================================
-- SISTEMA GARAMA (IMPLEMENTADO)
-- =============================================
local function acharGaramaInfo()
    local client = workspace:FindFirstChild("Client")
    local bases = client and client:FindFirstChild("Bases")
    if not bases then return nil end

    for _, base in ipairs(bases:GetChildren()) do
        local slots = base:FindFirstChild("Slots")
        if not slots then continue end

        for _, slot in ipairs(slots:GetChildren()) do
            local ui = slot:FindFirstChild("Brainrot_UI")
            local title = ui and ui:FindFirstChild("Frame") and ui.Frame:FindFirstChild("Title")
            
            if title and title:IsA("TextLabel") then
                local txt = title.Text:lower()
                local achou = false
                for _, termo in ipairs(TERMOS) do
                    if txt:find(termo) then achou = true break end
                end

                if achou then
                    local promptReal = nil
                    for _, obj in ipairs(slot:GetDescendants()) do
                        if obj:IsA("ProximityPrompt") then promptReal = obj break end
                    end
                    if not promptReal then
                        for _, obj in ipairs(base:GetDescendants()) do
                            if obj:IsA("ProximityPrompt") then promptReal = obj break end
                        end
                    end
                    return {slot = slot, promptReal = promptReal, texto = title.Text}
                end
            end
        end
    end
    return nil
end

local function forcarPromptDeLonge(prompt)
    if not prompt or promptsModificados[prompt] then return prompt ~= nil end
    prompt.MaxActivationDistance = DISTANCIA_MAX_FORCADA
    prompt.RequiresLineOfSight = false
    prompt.HoldDuration = 0
    prompt.Enabled = true
    promptsModificados[prompt] = true
    
    task.spawn(function()
        local old = prompt.ActionText
        prompt.ActionText = "üî• GARAMA DETECTADO"
        task.wait(4)
        if prompt.Parent then prompt.ActionText = old end
    end)
    return true
end

-- Loop Scanner Garama
task.spawn(function()
    while true do
        task.wait(1.5)
        if scriptFullyLoaded then
            local info = acharGaramaInfo()
            if info then
                if currentHighlight then currentHighlight:Destroy() end
                currentHighlight = Instance.new("Highlight")
                currentHighlight.Adornee = info.slot
                currentHighlight.FillColor = Color3.fromRGB(255, 40, 40)
                currentHighlight.Parent = info.slot
                
                if forcarPromptDeLonge(info.promptReal) then
                    -- Opcional: Notificar na tela quando achar o Garama
                    -- notify("GARAMA ENCONTRADO!", Color3.fromRGB(255, 50, 50))
                end
            else
                if currentHighlight then currentHighlight:Destroy() currentHighlight = nil end
            end
        end
    end
end)

-- =============================================
-- Fun√ß√µes de Movimento e GodMode
-- =============================================
function enableInfiniteZoom()
    plr.CameraMaxZoomDistance = 40000
    plr.CameraMinZoomDistance = 0.5
end

function applyGodMode()
    local char = waitForCharacter()
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    for _, conn in godConns do pcall(conn.Disconnect, conn) end
    godConns = {}
    hum.MaxHealth, hum.Health = math.huge, math.huge
    table.insert(godConns, hum.HealthChanged:Connect(function() hum.Health = math.huge end))
    table.insert(godConns, RunService.Heartbeat:Connect(function()
        if hum:GetState() == Enum.HumanoidStateType.Ragdoll then hum:ChangeState(Enum.HumanoidStateType.RunningNoPhysics) end
    end))
end

-- =============================================
-- Fly & VFly Logic
-- =============================================
local vflyEnabled, vflySpeed = false, 500
local vflyGyro, vflyVel, vflyConn

local function toggleFly()
    flying = not flying
    local char = plr.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChild("Humanoid")
    if hrp and hum then
        hrp.Anchored = flying
        hum.PlatformStand = flying
        if flying then
            RunService:BindToRenderStep("CFly", 201, function()
                local move = Vector3.new(controls.D - controls.A, controls.Space - controls.Ctrl, controls.W - controls.S)
                if move.Magnitude > 0 then move = move.Unit end
                hrp.CFrame = hrp.CFrame + (cam.CFrame:VectorToWorldSpace(move) * flySpeed)
            end)
            notify("FLY: ATIVADO", Color3.fromRGB(0, 255, 120))
        else
            RunService:UnbindFromRenderStep("CFly")
            notify("FLY: DESATIVADO", Color3.fromRGB(255, 70, 70))
        end
    end
end

local function toggleVFly()
    vflyEnabled = not vflyEnabled
    local char = plr.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    
    if vflyEnabled and hrp and hum then
        hum.PlatformStand = true
        vflyGyro = Instance.new("BodyGyro", hrp)
        vflyGyro.P = 9e4
        vflyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        vflyVel = Instance.new("BodyVelocity", hrp)
        vflyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        
        vflyConn = RunService.RenderStepped:Connect(function()
            local move = Vector3.new(controls.D - controls.A, controls.Space - controls.Ctrl, controls.W - controls.S)
            if move.Magnitude > 0 then move = move.Unit end
            vflyGyro.CFrame = cam.CFrame
            vflyVel.Velocity = (cam.CFrame.LookVector * move.Z * vflySpeed) + (cam.CFrame.RightVector * move.X * vflySpeed) + Vector3.new(0, move.Y * vflySpeed, 0)
        end)
        notify("VFLY: ATIVADO", Color3.fromRGB(0, 200, 255))
    else
        if vflyConn then vflyConn:Disconnect() end
        if vflyGyro then vflyGyro:Destroy() end
        if vflyVel then vflyVel:Destroy() end
        if hum then hum.PlatformStand = false end
        notify("VFLY: DESATIVADO", Color3.fromRGB(255, 80, 80))
    end
end

-- =============================================
-- Server Hop
-- =============================================
local function hopServer()
    local success, servers = pcall(function()
        return Http:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)
    if success and servers.data then
        for _, v in pairs(servers.data) do
            if v.playing < v.maxPlayers then
                Teleport:TeleportToPlaceInstance(game.PlaceId, v.id, plr)
                return
            end
        end
    end
end

-- =============================================
-- Inputs e Inicializa√ß√£o
-- =============================================
UIS.InputBegan:Connect(function(input, processed)
    if processed then return end
    local k = input.KeyCode
    if k == Enum.KeyCode.V then toggleVFly()
    elseif k == Enum.KeyCode.F then toggleFly()
    elseif k == Enum.KeyCode.T then hopServer()
    elseif k == Enum.KeyCode.W then controls.W = 1
    elseif k == Enum.KeyCode.S then controls.S = 1
    elseif k == Enum.KeyCode.A then controls.A = 1
    elseif k == Enum.KeyCode.D then controls.D = 1
    elseif k == Enum.KeyCode.Space then controls.Space = 1
    elseif k == Enum.KeyCode.LeftControl then controls.Ctrl = 1
    end
end)

UIS.InputEnded:Connect(function(input)
    local k = input.KeyCode
    if k == Enum.KeyCode.W then controls.W = 0
    elseif k == Enum.KeyCode.S then controls.S = 0
    elseif k == Enum.KeyCode.A then controls.A = 0
    elseif k == Enum.KeyCode.D then controls.D = 0
    elseif k == Enum.KeyCode.Space then controls.Space = 0
    elseif k == Enum.KeyCode.LeftControl then controls.Ctrl = 0
    end
end)

task.spawn(function()
    task.wait(1)
    scriptFullyLoaded = true
    applyGodMode()
    enableInfiniteZoom()
    notify("HAX CARREGADO + SCANNER GARAMA", Color3.fromRGB(0, 255, 140))
end)
